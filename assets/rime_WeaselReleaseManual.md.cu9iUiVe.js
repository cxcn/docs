import{_ as s,c as i,o as a,U as e}from"./chunks/framework.WKpLpN6N.js";const F=JSON.parse('{"title":"weasel 發佈手冊","description":"","frontmatter":{},"headers":[],"relativePath":"rime/WeaselReleaseManual.md","filePath":"home.wiki/WeaselReleaseManual.md"}'),l={name:"rime/WeaselReleaseManual.md"},t=e(`<h1 id="weasel-發佈手冊" tabindex="-1">weasel 發佈手冊 <a class="header-anchor" href="#weasel-發佈手冊" aria-label="Permalink to &quot;weasel 發佈手冊&quot;">​</a></h1><p>TODO: 更新該文檔，以反映自動化發佈流程</p><ol><li><p>在 <a href="https://trello.com/b/iUJWFnjb/rime-development" target="_blank" rel="noreferrer">Trello</a> 或筆記本上闢一葉紙，記下主要更新內容，方便粘貼到更新日誌。 例如 <a href="https://trello.com/c/WieadeZt" target="_blank" rel="noreferrer">https://trello.com/c/WieadeZt</a></p></li><li><p>對比上次發佈（git tag），檢查 <code>weasel.yaml</code> 是否需要更新版本號。 注：檢查配置更新的機制改動後，這一步不嚴格要求。但仍建議更新小狼毫配置同時升級該配置文件的版本。</p></li><li><p>代碼交齊後，用工具根據慣例格式生成變更記錄。（這一步合併到 <code>update/bump-version.sh</code> 腳本中） 以 clog-cli 爲例，爲新版本 0.11.0 生成變更記錄，做法是</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cargo install clog-cli</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> weasel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clog</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from-latest-tag</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --changelog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CHANGELOG.md</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --repository</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rime/weasel</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --setversion</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0</span></span></code></pre></div></li><li><p>把手寫的「主要更新」列在變更記錄文件中本次發佈的標題下，格式（包括空行）須與自動生成的段落相同：</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;a name=&quot;0.11.0&quot;&gt;&lt;/a&gt;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">## 0.11.0 (2018-04-07)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">#### 主要更新</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 新增 [</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;--shiki-light-text-decoration:underline;--shiki-dark-text-decoration:underline;">Rime 配置管理器</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">](</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;--shiki-light-text-decoration:underline;--shiki-dark-text-decoration:underline;">https://github.com/rime/plum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)，通過「輸入法設定／獲取更多輸入方案」調用</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 在輸入法語言欄顯示狀態切換按鈕（TSF 模式）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 修復多個前端兼容性問題</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 新增配色主題「現代藍」</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`metroblue\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、「幽能」</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\`psionics\`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">#### Features</span></span></code></pre></div></li><li><p>提交對變更記錄的修改（可以與版本號的修改合併爲一條提交記錄）</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --message</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;docs(CHANGELOG.md): release 0.11.0&quot;</span></span></code></pre></div></li><li><p>用腳本更新輸入法程序的版本號，並提交修改過的文件（腳本會在最後調用 <code>clog</code> 提取更新日誌）</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update/bump-version.sh</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # print usage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update/bump-version.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --message</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;chore(release): 0.11.0 :tada:&quot;</span></span></code></pre></div></li><li><p>以上提交在 <code>master</code> 完成。如果在另一個分支發佈，如 <code>legacy</code>，則將以上修改合併到分支。</p></li><li><p>push 所有修改到 GitHub。檢驗 CI build：下載安裝程序，測試全新安裝以及從上一個推送版本升級。</p></li><li><p>確認該版本可發佈後，在 <code>master</code> 或要做發佈的分支上打標籤。推送標籤到 GitHub 會在安裝包構建完成後自動觸發發佈到 bintray release 頻道的部署作業。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --annotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --message</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;chore(release): 0.11.0 :tada:&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tags</span></span></code></pre></div></li><li><p>AppVeyor 已經創建好了版本，並上傳了文件，只等一鍵發佈。如果手動完成，這個過程爲： 將（release tag 觸發的） CI build 生成的安裝包上傳到 bintray。 在 <a href="https://bintray.com/rime/weasel/release" target="_blank" rel="noreferrer">https://bintray.com/rime/weasel/release</a> 新建版本 (New version)，命名爲版本號 <code>0.11.0</code>，描述：<code>小狼毫 0.11.0</code>。 爲新建的版本上傳文件 <code>weasel-0.11.0.0-installer.exe</code>。</p></li><li><p>生成顯示在推送更新介面的變更記錄。只包含 <code>CHANGELOG.md</code> 的最新版本章節，格式爲樸素的 HTML 網頁。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># npm install --global marked</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update/write-release-notes.sh</span></span></code></pre></div><p>留存生成的 <code>release-notes.html</code> 文件備用。</p></li><li><p>使用 <a href="https://hexo.io/" target="_blank" rel="noreferrer">Hexo</a> 在官方網站 &lt;rime.im&gt; 發佈更新。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rime/home.git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rime-home</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rime-home/blog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hexo-cli</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># TODO(keyholder): edit files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/weasel/update/appcast.xml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/release/weasel/appcast.xml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/weasel/update/testing-appcast.xml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/testing/weasel/appcast.xml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/weasel/release-notes.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/release/weasel/release-notes.html</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/weasel/release-notes.html</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/testing/weasel/release-notes.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/code/rime/home/blog/source/release/weasel/index.md</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">title: 【小狼毫】更新日誌</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">comments: false</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;+date: %Y-%m-%d %H:%M:%S&#39;)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/weasel/CHANGELOG.md</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/release/weasel/index.md</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/code/rime/home/blog/source/release/weasel/index.md</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ~/code/rime/home/blog/source/testing/weasel/index.md</span></span></code></pre></div><p>需要修改的內容包括：</p><ul><li><a href="https://rime.im/" target="_blank" rel="noreferrer">首葉</a> 的下載按鈕：<a href="https://github.com/rime/home/blob/master/blog/source/_data/downloads.yaml" target="_blank" rel="noreferrer">源代碼</a></li><li><a href="https://rime.im/download/" target="_blank" rel="noreferrer">下載葉</a> 的版本號及下載鏈接：<a href="https://github.com/rime/home/blob/master/blog/source/download/index.md" target="_blank" rel="noreferrer">源代碼</a></li><li><a href="https://rime.im/release/weasel/" target="_blank" rel="noreferrer">更新日誌</a>， 更新 <a href="https://github.com/rime/home/blob/master/blog/source/release/weasel/index.md" target="_blank" rel="noreferrer">源代碼</a> 文件頭的 <code>date</code> 字段， 並用 <code>weasel/CHANGELOG.md</code> 的內容替換 Markdown 正文部份（YAML 結束標記 <code>---</code> 及隨後空行以下）</li><li><a href="https://rime.im/release/weasel/appcast.xml" target="_blank" rel="noreferrer">推送更新頻道</a>， 將 <a href="https://github.com/rime/home/blob/master/blog/source/release/weasel/appcast.xml" target="_blank" rel="noreferrer">源代碼</a> 替換爲第 5 步修改過的 <code>weasel/update/appcast.xml</code></li><li><a href="https://rime.im/release/weasel/release-notes.html" target="_blank" rel="noreferrer">推送更新提示</a>， 將 <a href="https://github.com/rime/home/blob/master/blog/source/release/weasel/release-notes.html" target="_blank" rel="noreferrer">源代碼</a> 替換爲第 10 步生成的 <code>release-notes.html</code></li></ul><p>測試頻道（用於手動檢查更新）自動化調試就緒前，將 <code>blog/source/release/weasel/</code> 的內容複製到 <code>blog/source/testing/weasel/</code>，唯獨需要用 <code>weasel/update/testing-appcast.xml</code> 更新 <code>blog/source/testing/weasel/appcast.xml</code>。</p></li><li><p>修改完成後，在本地調試網站。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># check your changes with local HTTP server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hexo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span></code></pre></div><p>方法爲：將以上修改過的網葉地址中的域名部份替換爲 Hexo 提示的本地服務器地址，在瀏覽器中預覽各個網葉，檢查文字內容和鏈接地址。</p></li><li><p>確認內容無誤，用 Hexo 發佈網站。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># first time releaser, setup without deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hexo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --setup</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># source XML/HTML files in generated folder may not get updated.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hexo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># publish website at rime.github.io</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hexo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --generate</span></span></code></pre></div><p>發佈完成後，可以在 <a href="https://github.com/rime/rime.github.io/commits/master" target="_blank" rel="noreferrer">https://github.com/rime/rime.github.io/commits/master</a> 複查提交到 GitHub Pages 的修訂。</p></li><li><p>提交以上修改到 <code>rime/home</code> 代碼庫。</p></li><li><p>如果本次發佈不是針對小狼毫 0.9 的升級版本（見第 6 步），發佈至此完成。 否則需要在驗證新版本工作正常後，將其推送到位於 &lt;rimeime.github.io&gt; 的舊更新頻道。</p><p>首先需要取得 <a href="https://github.com/rimeime/rimeime.github.io" target="_blank" rel="noreferrer">rimeime.github.io</a> 的寫權限。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rimeime/rimeime.github.io</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rimeime.github.io</span></span></code></pre></div></li><li><p>編輯 <code>weasel-update/appcast.xml</code> 以及 <code>weasel-update/pioneer/appcast.xml</code>： 從第 5 步的 <code>weasel/update/appcast.xml</code> 複製 <code>&lt;item&gt;</code> 標籤的內容，視情況修改 <code>channel &gt; title</code> 文字中的升級終點版本號。</p><p>當前版本同時在新、舊兩個更新頻道發佈，因此不必修改 &lt;rimeime.github.io&gt; 的更新日誌。 因爲根據 <code>appcast.xml</code> 中 <code>&lt;sparkle:releaseNotesLink&gt;</code> 的定義，推送更新提示一律從新官網 &lt;rime.github.io&gt; 加載。</p></li><li><p>最後提交修改，發出 pull-request。修改併入 <code>master</code> 即開始推送更新。</p></li></ol>`,3),n=[t];function p(h,r,k,o,d,c){return a(),i("div",null,n)}const m=s(l,[["render",p]]);export{F as __pageData,m as default};
